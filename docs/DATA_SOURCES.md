# Data Sources Documentation

This document describes all data dependencies for the NYC Assembly District 34 analysis project.

## Required Data Files (Included in Repository)

### Election Data (`data/raw/election/`)

| File | Size | Source | Used By | Description |
|------|------|--------|---------|-------------|
| `Precinct results.csv` | 3.3K | NYC BOE | 01_election_winners_map.R, 05_election_results_v2.R | Primary election results by precinct for AD34 |
| `NYS_Elections_Districts_and_Polling_Locations_*/` | ~40MB | NYS BOE | Multiple election scripts | Election district boundary shapefiles |

### Crosswalk Data (`data/raw/crosswalks/`)

| File | Size | Source | Used By | Description |
|------|------|--------|---------|-------------|
| `tab20_sldl202420_tract20_st36.txt` | 905K | Census Bureau | 01_acs_block_groups.R | Tract-to-SLDL (Assembly District) relationship table |

### Intermediate Data (`data/intermediate/`)

| File | Source | Used By | Description |
|------|--------|---------|-------------|
| `District 36.csv` | Manual | 05_election_results_v2.R | Election results for neighboring AD36 for comparison |
| Various comparison CSVs | Generated by scripts | Reference only | Output from demographic comparison analyses |

## Data Obtained Dynamically (No Files Needed)

The following data sources are accessed at runtime and **do not require local files**:

### Census Bureau Data (via `tidycensus` package)
- **American Community Survey (ACS)** 5-year estimates (2019-2023)
  - All demographic, economic, housing, and social characteristics
  - Accessed via Census API (requires API key)
  - Geography levels: Tract, Block Group, State Legislative District

- **TIGER/Line Boundaries** (via `tigris` package)
  - State Legislative Districts (Assembly Districts)
  - Census Tracts
  - Block Groups
  - Automatically downloaded and cached locally

### Election District Boundaries (via ArcGIS Online)
Some scripts download election district geometries directly from:
```
https://services6.arcgis.com/EbVsqZ18sv1kVJ3k/ArcGIS/rest/services/
NYS_Elections_Districts_and_Polling_Locations/FeatureServer/4/
```

This is an alternative to using the local shapefile.

## Optional Data Files (Not Included)

Some election analysis scripts require manually created CSV files for specific elections. These files are **optional** and only needed if running those specific scripts:

### Election Results CSVs (`outputs/AD34_outputs/`)

Required for time-series election analysis scripts (03, 06, 07):

| File | Required By | Description |
|------|-------------|-------------|
| `ED_Presidential_Margins_2024.csv` | 03_election_map_v3.R, 07_turnout_map.R | 2024 Presidential election results by ED |
| `ED_Zohran_Results_2025.csv` | 03_election_map_v3.R, 06_election_results_map.R, 07_turnout_map.R | 2025 general election results |
| `ED_Turnout_2021_Mayor.csv` | 07_turnout_map.R | 2021 mayoral election turnout |

**Format**: These should be CSV files with columns:
- `ed_code`: Election district code (format: "34-001", "34-002", etc.)
- Election-specific columns (vote counts, margins, turnout, etc.)

**How to create**: Process official BOE results files and aggregate to ED level.

## Setup Requirements

### Census API Key (Required)

1. Sign up for a free API key at: https://api.census.gov/data/key_signup.html
2. Add to your R scripts or `.Renviron`:
   ```r
   census_api_key("YOUR_KEY_HERE", install = TRUE)
   ```

### R Package Dependencies

Install required packages for data access:
```r
install.packages(c(
  "tidycensus",  # Census API access
  "tigris",      # TIGER/Line boundaries
  "sf",          # Spatial data handling
  "tidyverse"    # Data manipulation
))
```

## Data Storage Size

After cleanup (November 2024):
- **data/raw/**: 43 MB
  - Election data: ~40 MB (mostly shapefiles)
  - Crosswalk data: ~1 MB
  - Census data: ~1 MB (shapefile components)
- **data/intermediate/**: ~200 KB (analysis outputs)

## Data Update Schedule

| Data Source | Update Frequency | How to Update |
|-------------|------------------|---------------|
| ACS Data | Annual (September) | Change `year = 2023` in scripts |
| TIGER/Line Boundaries | Annual | Change `year = 2025` in `state_legislative_districts()` calls |
| Election Results | Per election | Add new CSV files to `data/raw/election/` |
| Census API Key | One-time | Set in `.Renviron` |

## Removed Data (Cleanup November 2024)

The following data was removed as unused (freed 988 MB):

- ❌ `sldl_2022/` - All 50 states SLDL data (323 MB) - Replaced by tigris dynamic download
- ❌ `sldl24/` and `sldl24 2/` - Duplicate SLDL directories (410 MB total)
- ❌ `Tracts/` - Duplicate crosswalk data (230 MB)
- ❌ `*.zip` files - Archive files (73 MB)
- ❌ `public_grfc_cur25_36.txt` - Unreferenced data file (96 MB)
- ❌ `tlgdb_2024_a_us_legislative.gdb/` - Unused geodatabase (141 MB)
- ❌ `NYS_Assembly_Districts_*/` - Unused shapefiles (5.1 MB)
- ❌ `NY_SF.*` - Unused shapefiles (656 KB)
- ❌ `ACS_*.xlsx` and `ACS_*.csv` - Generated outputs, not inputs (moved to intermediate/)

## Troubleshooting

### "Cannot find data file"
- Verify you're in project root: `getwd()` should show `~/Mayoral Results AD34`
- Check file exists: `file.exists("data/raw/election/Precinct results.csv")`

### "Census API error"
- Verify API key is set: `Sys.getenv("CENSUS_API_KEY")`
- Check API key is valid at: https://api.census.gov/data/key_signup.html

### "Missing ED result files"
- These are optional files for specific election analysis scripts
- You can create them from BOE results or skip those scripts
- See "Optional Data Files" section above

## Data Sources Links

- **Census API**: https://www.census.gov/data/developers/data-sets.html
- **ACS Variables**: https://data.census.gov
- **NYC BOE**: https://vote.nyc
- **NYS BOE**: https://elections.ny.gov
- **TIGER/Line**: https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html
